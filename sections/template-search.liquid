{% liquid 
    assign mt = section.settings.mt | prepend: 'mt-'
    assign mb = section.settings.mb | prepend: 'mb-'

    assign row_xs = section.settings.row_xs | prepend: 'row-cols-'
    assign row_sm = section.settings.row_sm | prepend: 'row-cols-sm-'
    assign row_lg = section.settings.row_lg | prepend: 'row-cols-lg-'

%}

{% liquid
    assign img_width  = 120
    assign img_height = 120
    assign img_thumbnail = 'img-thumbnail'
%}

<section id="template-search" class="{{ mt }} {{ mb }}">
    <div id="template-search-header" class="mb-9 bg-light overflow-hidden">
        <div class="container">
            <div class="mx-auto text-center py-10" style="max-width: 560px">
                <h1 class="title text-uppercase mb-4">
                    {% if search.performed %}
                        {{ 'general.search_page.title_search_performed' | t }}
                    {% else %}
                        {{ 'general.search_page.title' | t }}
                    {% endif %}
                </h1>
                <form action="{{ routes.search_url }}">
                    <div class="input-group input-group-lg">
                        <input 
                            class="form-control"
                            type="search"
                            placeholder="{{ 'general.search_page.form.input_label' | t }}"
                            aria-label="{{ 'general.search_page.form.input_label' | t }}"
                            name="q"
                            value="{{ search.terms | escape }}">
                        <button 
                            type="submit"
                            class="btn btn-primary">
                            {{ 'general.search_page.form.btn_text' | t }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    {% if search.performed %}
        <div class="container search-page-container">
        
            {% if search.results_count == 0 %}        
                <p class="alert alert-warning" role="status">
                    {{ 'general.search_page.no_results' | t: terms: search.terms }}
                </p>
            {% else %}
                {% assign productExist = false %}
                {% assign articleExist = false %}
                {% assign pageExist = false %}
                {% assign resultCount = 0 %}

                {% for item in search.results %}
                    {% case item.object_type %}
                        {% when 'product' %}
                            {% assign productExist = true %}
                        {% when 'article' %}
                            {% assign articleExist = true %}
                        {% when 'page' %}
                            {% assign pageExist = true %}
                    {% endcase %}
                {% endfor %}
                
                <div>
                    {% if productExist %}
                        <h2>Products</h2>
                    {% endif %}
                    {% paginate search.results by section.settings.limit %}
                        <ul class="product-list list-unstyled row mx-n3 mb-0 {{ section.settings.text_align }} {{ row_xs }} {{ row_sm }} {{ row_lg }}">
                            {% for item in search.results %}
                                {% case item.object_type %}
                                    {% when 'product' %}
                                        {% render 'product-item', product: item %}
                                        {% assign resultCount = resultCount | plus: 1 %}
                                {% endcase %}
                            {% endfor %}
                        </ul>
                        {% render 'pagination' with paginate: paginate %}
                    {% endpaginate %}

                    <div class="search-result__blog">
                        {% if articleExist %}
                            <h2>Articles</h2>
                        {% endif %}
                        {% for item in search.results %}
                            {% case item.object_type %}
                                {%- when 'article' -%}
                                {% assign resultCount = resultCount | plus: 1 %}
                                    <div  class="search-result__blog-item mb-5">
                                        <div class="px-3">
                                            <a href="{{ item.url }}" class="full-unstyled-link">
                                                <img 
                                                    class="article-item-img img-fluid me-3 {{ img_thumbnail }}"
                                                    src="{{ item.image | image_url: width: img_width, height: img_height }}"
                                                    alt="{{ item.image.alt }}"
                                                    width="{{ img_width }}"
                                                    height="{{ img_height }}"
                                                    loading="lazy"
                                                >
                                            </a>
                                        </div>
                                        <div class="px-3">
                                            <h3>
                                                <a href="{{ item.url }}" class="full-unstyled-link">
                                                    {{ item.title }}
                                                </a>
                                            </h3>
                                        </div>
                                    </div>
                            {% endcase %}
                        {% endfor %}
                    </div>

                    <div class="search-result__page">
                        {% if pageExist %}
                            <h2>Pages</h2>
                        {% endif %}
                        {% for item in search.results %}
                            {% case item.object_type %}
                                {%- when 'page' -%}
                                {% assign resultCount = resultCount | plus: 1 %}
                                    <h3>
                                        <a href="{{ item.url }}" class="full-unstyled-link">
                                            {{ item.title | truncate: 50 | escape }}
                                        </a>
                                    </h3>
                            {% endcase %}
                        {% endfor %}
                    </div>
                </div>

                <p class="alert alert-info" role="status">
                    {{ 'general.search_page.results_with_count_and_term' | t: terms: search.terms, count: resultCount }}
                </p>
          
            {% endif %}
        </div>
    {% endif %}

</div>

{% schema %}
{
    "name": "Search template",
    "settings": [
        {
            "type": "header",
            "content": "General"
        },
        {
            "type": "range",
            "id": "limit",
            "label": "Products per page",
            "min": 10,
            "max": 50,
            "default": 40
        },
        {
            "type": "select",
            "id": "text_align",
            "label": "Text align",
            "default": "text-center",
            "options": [
                { "value": "text-start", "label": "Left" },
                { "value": "text-center", "label": "Center" }
            ]
        },
        {
            "type": "header",
            "content": "Items per row"
        },
        {
            "type": "range",
            "id": "row_xs",
            "label": "Mobile",
            "info": "up to 575px",
            "min": 1,
            "max": 3,
            "step": 1,
            "default": 2
        },
        {
            "type": "range",
            "id": "row_sm",
            "label": "Tablet",
            "info": "576px - 991px",
            "min": 1,
            "max": 4,
            "step": 1,
            "default": 2
        },
        {
            "type": "range",
            "id": "row_lg",
            "label": "Desktop",
            "info": "992px and up",
            "min": 1,
            "max": 6,
            "step": 1,
            "default": 4
        },
        {
            "type": "header",
            "content": "Spacing"
        },
        {
            "type": "range",
            "id": "mt",
            "label": "Margin top",
            "min": 0,
            "max": 20,
            "step": 1,
            "default": 0
        },
        {
            "type": "range",
            "id": "mb",
            "label": "Margin bottom",
            "min": 0,
            "max": 20,
            "step": 1,
            "default": 10
        }
    ]
}
{% endschema %}